
using Conveyor.Utility;

using NUnit.Framework;
using System;

namespace Conveyor.NetCore.Test.Utility
{
    public class StringCipherTest
    {

		[SetUp]
		public void Initialize()
		{
			Environment.SetEnvironmentVariable("CONVEYOR_SECRET_KEY", "4-S3cr3t-v4lu3", EnvironmentVariableTarget.Process);
		}



		[TearDown]
		public void Cleanup()
		{
			// Clean up the environment variable after the test completes
			Environment.SetEnvironmentVariable("CONVEYOR_SECRET_KEY", null, EnvironmentVariableTarget.Process);
		}


		[TestCase(LongMessageJson)]
		[TestCase(LongMessage120)]
		[TestCase(LongMessage135)]
		[TestCase(LongMessage2244)]
		[TestCase(LongMessage2256)]
		[TestCase(ShortMessageWithUnicodeChars)]
		public void VerifyEncryptDecryptOfMessage(string source)
		{
			// Act
			var encrypted = StringCipher.Encrypt(source);
			var decrypted = StringCipher.Decrypt(encrypted);

			// Assert
			Assert.That(source, !Is.EqualTo(encrypted));
			Assert.That(source, Is.EqualTo(decrypted));
		}

		private const string ShortMessageWithUnicodeChars = "Simple sample with some åäöÅÄÖ and other stuff [üñ]";

		private const string LongMessageJson =
			"{\"nodeType\":\"Lambda\",\"type\":{\"assemblyName\":\"System.Private.CoreLib, Version=6.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e\",\"typeName\":\"System.Func`2\",\"genericArguments\":[{\"assemblyName\":\"Conveyor.NetCore.Test, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\",\"typeName\":\"Conveyor.NetCore.Test.Tools.SampleViewModel\",\"genericArguments\":null},{\"assemblyName\":\"System.Private.CoreLib, Version=6.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e\",\"typeName\":\"System.Boolean\",\"genericArguments\":null}]},\"typeName\":\"lambda\",\"name\":null,\"parameters\":[{\"nodeType\":\"Parameter\",\"type\":{\"assemblyName\":\"Conveyor.NetCore.Test, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\",\"typeName\":\"Conveyor.NetCore.Test.Tools.SampleViewModel\",\"genericArguments\":null},\"typeName\":\"parameter\",\"name\":\"x\"}],\"body\":{\"nodeType\":\"GreaterThan\",\"type\":{\"assemblyName\":\"System.Private.CoreLib, Version=6.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e\",\"typeName\":\"System.Boolean\",\"genericArguments\":null},\"typeName\":\"binary\",\"left\":{\"nodeType\":\"MemberAccess\",\"type\":{\"assemblyName\":\"System.Private.CoreLib, Version=6.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e\",\"typeName\":\"System.Int32\",\"genericArguments\":null},\"typeName\":\"member\",\"expression\":{\"nodeType\":\"Parameter\",\"type\":{\"assemblyName\":\"Conveyor.NetCore.Test, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\",\"typeName\":\"Conveyor.NetCore.Test.Tools.SampleViewModel\",\"genericArguments\":null},\"typeName\":\"parameter\",\"name\":\"x\"},\"member\":{\"type\":{\"assemblyName\":\"Conveyor.NetCore.Test, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\",\"typeName\":\"Conveyor.NetCore.Test.Tools.SampleViewModel\",\"genericArguments\":null},\"memberType\":16,\"name\":\"IntValue\",\"signature\":\"Int32 IntValue\"}},\"right\":{\"nodeType\":\"Constant\",\"type\":{\"assemblyName\":\"System.Private.CoreLib, Version=6.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e\",\"typeName\":\"System.Int32\",\"genericArguments\":null},\"typeName\":\"constant\",\"value\":{\"type\":{\"assemblyName\":\"System.Private.CoreLib, Version=6.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e\",\"typeName\":\"System.Int32\",\"genericArguments\":null},\"value\":1}},\"method\":null,\"conversion\":null,\"liftToNull\":false},\"tailCall\":false}";

		private const string LongMessage120 =
			"123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890";

		private const string LongMessage135 =
			"123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345";


		private const string LongMessage2244 =
			"123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234";

		private const string LongMessage2256 =
			"123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456";

	}
}
